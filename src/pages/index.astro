---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const concepts = (await getCollection("concepts")).filter(
	(c) => !c.slug.startsWith("_"),
);

// Sort by date (descending) if available, or fallback to first found
const sortedConcepts = concepts.sort((a, b) => {
	const dateA = a.data.publishDate?.getTime() ?? 0;
	const dateB = b.data.publishDate?.getTime() ?? 0;
	return dateB - dateA;
});

// Featured is the very first one
const featured = sortedConcepts[0];
---

<BaseLayout
	title="How the Web Works"
	description="The clearest explanations of web concepts on the internet."
>
	<div
		class="min-h-[80vh] flex flex-col justify-center max-w-[var(--spacing-container)] mx-auto px-6"
	>
		<header class="mb-16 md:mb-24">
			<h1
				class="font-serif text-7xl md:text-9xl font-bold tracking-tighter leading-[0.9] mb-8 animate-reveal"
			>
				How The <br />
				<span class="italic text-black/80">Web Works</span>
			</h1>
			<p
				class="font-mono text-sm max-w-md leading-relaxed text-black/60 uppercase tracking-wide border-l-2 border-black pl-6 animate-reveal delay-100"
			>
				Moving beyond syntax. <br />
				Building deep mental models <br />
				for engineering excellence.
			</p>
		</header>

		{
			featured ? (
				<div class="relative group animate-reveal delay-200">
					<div class="mb-4 flex items-center gap-3">
						<span class="h-px w-8 bg-black/30" />
						<span class="font-mono text-xs font-bold uppercase tracking-widest text-black/40">
							Latest Concept
						</span>
					</div>

					<a
						href={`/concepts/${featured.slug}`}
						class="block group-hover:opacity-80 transition-opacity"
					>
						<h2 class="font-serif text-5xl md:text-7xl font-bold mb-6 underline decoration-2 underline-offset-8 decoration-black/10 group-hover:decoration-black transition-all">
							{featured.data.title}
						</h2>
						<p class="font-sans text-xl md:text-2xl leading-relaxed text-black/70 max-w-2xl mb-10">
							{featured.data.description}
						</p>

						<div class="inline-flex items-center gap-3 bg-black text-white px-8 py-4 rounded-full font-mono text-sm font-bold uppercase tracking-widest group-hover:bg-black/80 transition-colors">
							Read Now
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="18"
								height="18"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<>
									<line x1="5" y1="12" x2="19" y2="12" />
									<polyline points="12 5 19 12 12 19" />
								</>
							</svg>
						</div>
					</a>
				</div>
			) : (
				<div class="py-20 text-center font-mono">
					No concepts published yet.
				</div>
			)
		}

		<div
			class="mt-32 pt-12 border-t border-black/10 flex justify-between items-baseline animate-reveal delay-300"
		>
			<p class="font-serif italic text-lg text-black/50">
				Looking for more?
			</p>
			<a
				href="/curriculum"
				class="font-mono text-sm font-bold uppercase tracking-widest border-b border-black pb-1 hover:text-black/60 hover:border-black/60 transition-all"
			>
				View Full Curriculum â†’
			</a>
		</div>
	</div>
</BaseLayout>
